!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(n=n||self).ErrorWatch=e()}(this,function(){"use strict";var i=!0,r=!0,a=11,m="ErrorWatch.report";function b(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function g(n){return void 0===n}var h="?",l={};function k(n){if("string"!=typeof n)return[];if(!b(l,n)){var e="",t="";try{t=window.document.domain}catch(n){}var r=/(.*)\:\/\/([^:\/]+)([:\d]*)\/{0,1}([\s\S]*)/.exec(n);r&&r[2]===t&&(e=""),l[n]=e?e.split("\n"):[]}return l[n]}function y(n,e){var t,r=/function ([^(]*)\(([^)]*)\)/,l=/['"]?([0-9A-Za-z$_]+)['"]?\s*[:=]\s*(function|eval|new Function)/,i=k(n),u="";if(!i.length)return h;for(var c=0;c<10;++c)if(!g(u=i[e-c]+u)){if(t=l.exec(u))return t[1];if(t=r.exec(u))return t[1]}return h}function S(n,e){var t=k(n);if(!t.length)return null;var r=[],l=Math.floor(a/2),i=l+a%2,u=Math.max(0,e-l-1),c=Math.min(t.length,e+i-1);--e;for(var o=u;o<c;++o)g(t[o])||r.push(t[o]);return 0<r.length?r:null}function d(n){return n.replace(/[\-\[\]{}()*+?.,\\\^$|#]/g,"\\$&")}function E(n){return d(n).replace("<","(?:<|&lt;)").replace(">","(?:>|&gt;)").replace("&","(?:&|&amp;)").replace('"','(?:"|&quot;)').replace(/\s+/g,"\\s+")}function $(n,e){for(var t,r,l=0,i=e.length;l<i;++l)if((t=k(e[l])).length&&(t=t.join("\n"),r=n.exec(t)))return{url:e[l],line:t.substring(0,r.index).split("\n").length,column:r.index-t.lastIndexOf("\n",r.index)-1};return null}function w(n,e,t){var r,l=k(e),i=new RegExp("\\b"+d(n)+"\\b");return--t,l&&l.length>t&&(r=i.exec(l[t]))?r.index:null}function u(n){if(!n.stack)return null;for(var e,t,r,l=/^\s*at (.*?) ?\(((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,i=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|\[native).*?|[^@]*bundle)(?::(\d+))?(?::(\d+))?\s*$/i,u=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,c=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,o=/\((\S*)(?::(\d+))(?::(\d+))\)/,a=n.stack.split("\n"),s=/^(.*) is undefined$/.exec(n.message),f=[],m=0,d=a.length;m<d;++m){if(t=l.exec(a[m])){var p=t[2]&&0===t[2].indexOf("native");t[2]&&0===t[2].indexOf("eval")&&(e=o.exec(t[2]))&&(t[2]=e[1],t[3]=e[2],t[4]=e[3]),r={url:p?null:t[2],func:t[1]||h,args:p?[t[2]]:[],line:t[3]?+t[3]:null,column:t[4]?+t[4]:null}}else if(t=u.exec(a[m]))r={url:t[2],func:t[1]||h,args:[],line:+t[3],column:t[4]?+t[4]:null};else{if(!(t=i.exec(a[m])))continue;t[3]&&-1<t[3].indexOf(" > eval")&&(e=c.exec(t[3]))?(t[3]=e[1],t[4]=e[2],t[5]=null):0!==m||t[5]||g(n.columnNumber)||(f[0].column=n.columnNumber+1),r={url:t[3],func:t[1]||h,args:t[2]?t[2].split(","):[],line:t[4]?+t[4]:null,column:t[5]?+t[5]:null}}!r.func&&r.line&&(r.func=y(r.url,r.line)),r.context=r.line?S(r.url,r.line):null,f.push(r)}return f.length?(f[0]&&f[0].line&&!f[0].column&&s&&(f[0].column=w(s[1],f[0].url,f[0].line)),{mode:"stack",name:n.name,message:n.message,stack:f}):null}function p(n,e,t,r){var l={url:e,line:t};if(l.url&&l.line){n.incomplete=!1,l.func||(l.func=y(l.url,l.line)),l.context||(l.context=S(l.url,l.line));var i=/ '([^']+)' /.exec(r);if(i&&(l.column=w(i[1],l.url,l.line)),0<n.stack.length&&n.stack[0].url===l.url){if(n.stack[0].line===l.line)return!1;if(!n.stack[0].line&&n.stack[0].func===l.func)return n.stack[0].line=l.line,n.stack[0].context=l.context,!1}return n.stack.unshift(l),n.partial=!0}return!(n.incomplete=!0)}function v(n,e){for(var t,r,l,i,u=/function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i,c=[],o={},a=!1,s=v.caller;s&&!a;s=s.caller)if(!(s===x||s&&s.__name__===m)){if(r={url:null,func:h,args:[],line:null,column:null},s.name?r.func=s.name:(t=u.exec(s.toString()))&&(r.func=t[1]),void 0===r.func)try{r.func=t.input.substring(0,t.input.indexOf("{"))}catch(n){}(l=function(n){if(g(window&&window.document))return null;for(var e,t,r,l,i,u=[window.location.href],c=window.document.getElementsByTagName("script"),o=""+n,a=0;a<c.length;++a){var s=c[a];s.src&&u.push(s.src)}if(t=$((e=/^function(?:\s+([\w$]+))?\s*\(([\w\s,]*)\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/.exec(o))?(r=e[1]?"\\s+"+e[1]:"",l=e[2].split(",").join("\\s*,\\s*"),i=d(e[3]).replace(/;$/,";?"),new RegExp("function"+r+"\\s*\\(\\s*"+l+"\\s*\\)\\s*{\\s*"+i+"\\s*}")):new RegExp(d(o).replace(/\s+/g,"\\s+")),u))return t;if(e=/^function on([\w$]+)\s*\(event\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/.exec(o)){var f=e[1];if(i=E(e[2]),t=$(new RegExp("on"+f+"=[\\'\"]\\s*"+i+"\\s*[\\'\"]","i"),u[0]))return t;if(t=$(new RegExp(i),u))return t}return null}(s))&&(r.url=l.url,r.line=l.line,r.func===h&&(r.func=y(r.url,r.line)),(i=/ '([^']+)' /.exec(n.message||n.description))&&(r.column=w(i[1],l.url,l.line))),o[""+s]?a=!0:o[""+s]=!0,c.push(r)}e&&c.splice(0,e);var f={mode:"callers",name:n.name,message:n.message,stack:c};return p(f,n.sourceURL||n.fileName,n.line||n.lineNumber,n.message||n.description),f}function x(n,e){var t=null;e=null==e?0:+e;try{if(t=function(n){var e=n.stacktrace;if(e){for(var t,r=/ line (\d+).*script (?:in )?(\S+)(?:: in function (\S+))?$/i,l=/ line (\d+), column (\d+)\s*(?:in (?:<anonymous function: ([^>]+)>|([^\)]+))\((.*)\))? in (.*):\s*$/i,i=e.split("\n"),u=[],c=0;c<i.length;c+=2){var o=null;if((t=r.exec(i[c]))?o={url:t[2],line:+t[1],column:null,func:t[3],args:[]}:(t=l.exec(i[c]))&&(o={url:t[6],line:+t[1],column:+t[2],func:t[3]||t[4],args:t[5]?t[5].split(","):[]}),o){if(!o.func&&o.line&&(o.func=y(o.url,o.line)),o.line)try{o.context=S(o.url,o.line)}catch(n){}o.context||(o.context=[i[c+1]]),u.push(o)}}return u.length?{mode:"stacktrace",name:n.name,message:n.message,stack:u}:null}}(n))return t}catch(n){}try{if(t=u(n))return t}catch(n){}try{if(t=function(n){var e=n.message.split("\n");if(e.length<4)return null;var t,r=/^\s*Line (\d+) of linked script ((?:file|https?|blob)\S+)(?:: in function (\S+))?\s*$/i,l=/^\s*Line (\d+) of inline#(\d+) script in ((?:file|https?|blob)\S+)(?:: in function (\S+))?\s*$/i,i=/^\s*Line (\d+) of function script\s*$/i,u=[],c=window&&window.document&&window.document.getElementsByTagName("script"),o=[];for(var a in c)b(c,a)&&!c[a].src&&o.push(c[a]);for(var s=2;s<e.length;s+=2){var f,m,d,p,g,h,w,v,x=null;(t=r.exec(e[s]))?x={url:t[2],func:t[3],args:[],line:+t[1],column:null}:(t=l.exec(e[s]))?(x={url:t[3],func:t[4],args:[],line:+t[1],column:null},f=+t[1],(m=o[t[2]-1])&&(!(d=k(x.url))||0<=(p=(d=d.join("\n")).indexOf(m.innerText))&&(x.line=f+d.substring(0,p).split("\n").length))):(t=i.exec(e[s]))&&(x={url:g=window.location.href.replace(/#.*$/,""),func:"",args:[],line:(h=$(new RegExp(E(e[s+1])),[g]))?h.line:t[1],column:null}),x&&(x.func||(x.func=y(x.url,x.line)),v=(w=S(x.url,x.line))?w[Math.floor(w.length/2)]:null,w&&v.replace(/^\s*/,"")===e[s+1].replace(/^\s*/,"")?x.context=w:x.context=[e[s+1]],u.push(x))}return u.length?{mode:"multiline",name:n.name,message:e[0],stack:u}:null}(n))return t}catch(n){}try{if(t=v(n,e+1))return t}catch(n){}return{name:n.name,message:n.message,mode:"failed"}}x.augmentStackTraceWithInitialElement=p,x.computeStackTraceFromStackProp=u,x.guessFunctionName=y,x.gatherContext=S,x.ofCaller=function(e){e=1+(null==e?0:+e);try{throw new Error}catch(n){return x(n,e+1)}},x.getSource=k;var c=!1,o=null;var s,t,f,F,j=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/,T=[],_=null,R=null;function N(n,e,t){var r=null;if(!e||i){for(var l in T)if(b(T,l))try{T[l](n,e,t)}catch(n){r=n}if(r)throw r}}function e(n,e,t,r,l){var i,u,c,o;return R?(x.augmentStackTraceWithInitialElement(R,e,t,n),O()):l?N(x(l),!0,l):(i={url:e,line:t,column:r},c=n,"[object String]"!=={}.toString.call(n)||(o=n.match(j))&&(u=o[1],c=o[2]),i.func=x.guessFunctionName(i.url,i.line),i.context=x.gatherContext(i.url,i.line),N({name:u,message:c,mode:"onerror",stack:[i]},!0,null)),!!s&&s.apply(this,arguments)}function L(n){N(x(n.reason),!0,n.reason)}function O(){var n=R,e=_;_=R=null,N(n,!1,e)}function A(n){if(R){if(_===n)return;O()}var e=x(n);throw R=e,_=n,setTimeout(function(){_===n&&O()},e.incomplete?2e3:0),n}function I(n){return function(){try{return n.apply(this,arguments)}catch(n){throw A(n),n}}}A.subscribe=function(n){!function(){if(!0===t)return;s=window.onerror,window.onerror=e,function(t){!c&&r&&(o=t,window.addEventListener&&window.addEventListener("error",function(n){try{var e;n.target!==window&&(e={message:"".concat(n.target.localName," is load error"),mode:"resource",name:n.target.src||n.target.href||n.target.currentSrc,stack:null},t(e,!0,n))}catch(n){throw n}},!0)),c=!0}(function(n,e,t){N(n,e,t)}),t=!0}(),function(){if(!0===F)return;f=window.onunhandledrejection,window.onunhandledrejection=L,F=!0}(),T.push(n)},A.unsubscribe=function(n){for(var e=T.length-1;0<=e;--e)T[e]===n&&T.splice(e,1);0===T.length&&(t&&(window.onerror=s,c&&r&&o&&(window.removeEventListener&&window.removeEventListener("error",o),o=null,c=!1),t=!1),F&&(window.onunhandledrejection=f,F=!1))},A.__name__=m;var W=[].slice;function n(n){var t=window[n];window[n]=function(){var n=W.call(arguments),e=n[0];return"function"==typeof e&&(n[0]=I(e)),t.apply?t.apply(this,n):t(n[0],n[1])}}var C,M=window.ErrorWatch;return C={noConflict:function(){return window.ErrorWatch=M,C},report:A,computeStackTrace:x,wrap:I,extendToAsynchronousCallbacks:function(){n("setTimeout"),n("setInterval")},makeError:function(){return thisIsAbug+""}}});
//# sourceMappingURL=errorWatch.min.js.map
